---
title: "Creating a database cluster with TDE enabled" 
navTitle: Creating a cluster with TDE
---

You enable transparent data encryption when you initialize a database cluster using [initdb](https://www.postgresql.org/docs/15/app-initdb.html). 



## Example

This example uses EDB Postgres Advanced Server 15 running on a Linux platform. It uses openssl to define the passkey to wrap and unwrap the generated data encryption key.

1. Set the data encryption key (wrap) and decryption (unwrap) environment variables:

   ```shell
   export PGDATAKEYWRAPCMD='openssl enc -e -aes-128-cbc -pass pass:ok -out %p'
   export PGDATAKEYUNWRAPCMD='openssl enc -d -aes-128-cbc -pass pass:ok -in %p'
   ```
   !!!note
      If you are on Windows you don't need the single quotes around the variable value.

1. Initialize the cluster using `initdb` with encryption enabled. This command sets the `data_encryption_key_unwrap_command` parameter in the postgresql.conf file.

   ```shell
   /usr/edb/as15/bin/initdb --data-encryption -D /var/lib/edb/as15/data 
   ```
   
1. Start the cluster:

   ```shell
   /usr/edb/as15/bin/pg_ctl -D /var/lib/edb/as15/data start
   ```

1. Run grep on postgresql.conf to see the setting of `data_encryption_key_unwrap_command`: 

   ```shell
   grep data_encryption_key_unwrap_command /var/lib/edb/as15/data/postgresql.conf
   __OUTPUT__
   data_encryption_key_unwrap_command = 'openssl enc -d -aes-128-cbc -pass pass:ok -in %p'
   ```

## Checking for TDE presence using SQL

You can find out whether TDE is present on a server by querying the `data_encryption_version` column of the `pg_control_init` table. 

A value of 0 means TDE isn't enabled. Any nonzero value reflects the version of TDE in use. Currently, when TDE is enabled, this value is 1.

```sql
select data_encryption_version from pg_control_init();
__OUTPUT__
 data_encryption_version
-------------------------
                       1
(1 row)
```

