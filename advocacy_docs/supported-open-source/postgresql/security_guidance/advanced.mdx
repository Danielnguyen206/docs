---
title: "Advanced PostgreSQL Security"
navTitle: "Advanced Security"
deepToC: true
---

As security requirements increase in complexity, it’s critical to move beyond basic and intermediate configurations. 
Advanced security in PostgreSQL focuses on hardening systems to meet strict compliance standards such as STIGs (Security Technical Implementation Guides), GDPR, PCI-DSS, HIPAA, and FISMA. 
This guide covers advanced strategies for securing PostgreSQL in high-stakes environments.

### 1. Security Technical Implementation Guides (STIGs)

STIGs are configuration standards developed by the Defense Information Systems Agency (DISA) to ensure that IT systems meet strict security controls. PostgreSQL has its own specific STIGs, which must be followed when the database is used in government or defense environments.

- **Install PostgreSQL STIG**: Ensure your PostgreSQL setup complies with STIG guidelines.
- **STIG Compliance Auditing**: Use `pgSTIG` or other tools to audit PostgreSQL for STIG compliance.
- **STIG Hardening**: Follow STIG guidelines for logging, encryption, and auditing role changes.

Install PostgreSQL STIG: Ensure that your PostgreSQL installation meets the guidelines of the PostgreSQL STIG. This includes hardening configurations, removing unnecessary features, and enforcing security controls.

STIG Compliance Auditing: The stig-postgresql project provides automated scripts to check for STIG compliance. Use tools like pgSTIG or security scanners to verify your PostgreSQL configurations against STIG guidelines.

STIG Hardening Examples:

Log All Activity: STIGs mandate strict logging of user activity. Configure PostgreSQL to log all SQL commands, even reads, to ensure traceability.

```bash
log_statement = 'all'
log_connections = on
log_disconnections = on
```

Encrypt Data at Rest: Encrypt the data directory and backups as per STIG requirements. Encryption standards should follow industry best practices (AES-256).

Audit Role Changes and Privileges: Regularly audit role changes and privilege escalations, logging all role modifications and access control changes.

```bash
log_statement = 'ddl'
```

### 2. Compliance Requirements

For information on EDB data privacy and compliance policies, see the [EDB Trust Center](https://trust.enterprisedb.com).

#### 2.1 GDPR (General Data Protection Regulation)
- **Data Minimization**: Only collect and store necessary data.
- **Right to Erasure**: Implement procedures for securely deleting user data.
- **Data Breach Notifications**: Ensure logging and monitoring are in place to detect breaches.

The European Union’s GDPR focuses on protecting the privacy and security of personal data. PostgreSQL must be configured to ensure data privacy, security, and accountability.

Data Minimization and Encryption: Ensure that only essential data is collected and stored. Implement both column-level encryption for sensitive data and full-disk encryption for databases.
pgcrypto allows you to encrypt/decrypt sensitive columns:

```sql
SELECT pgp_sym_encrypt('personal data', 'encryption_key');
```

Right to Erasure (Data Deletion): Implement functionality to allow for complete and secure deletion of user data upon request.
For a compliant data deletion process, ensure that records are fully purged, including from backup systems, to comply with GDPR's "Right to be Forgotten".

Data Breach Notifications: In the event of a data breach, GDPR mandates prompt notification. PostgreSQL logging, auditing, and alerting should help detect breaches immediately.

#### 2.2 PCI-DSS (Payment Card Industry Data Security Standard)
- **Encryption**: Encrypt cardholder data at rest and in transit.
- **Segregation of Duties**: Use role-based access to separate administrative and data access functions.
- **Detailed Logging**: Log access to cardholder data with `pgaudit`.

PCI-DSS ensures the secure handling of payment card information. PostgreSQL must be hardened to prevent unauthorized access to sensitive cardholder data.

Data Encryption: PCI-DSS mandates encryption of cardholder data both in transit and at rest. Use scram-sha-256 for encrypting connections and client-side encryption for cardholder data.

Segregation of Duties: Ensure that users accessing the database are restricted to specific tasks and cannot access cardholder data unnecessarily. This can be done using PostgreSQL’s Role-Based Access Control (RBAC).

Use roles to enforce separation:
```sql
CREATE ROLE cardholder_data_access;
GRANT SELECT ON card_data TO cardholder_data_access;
```

Logging and Monitoring: PCI-DSS requires detailed logging of all access to cardholder data. Use pgaudit to track reads, writes, and role changes to sensitive data.

#### 2.3 HIPAA (Health Insurance Portability and Accountability Act)
- **Encrypt PHI**: Ensure all protected health information is encrypted.
- **Access Control**: Use role-based access and MFA for critical access to sensitive health data.
- **Audit Trails**: Ensure detailed logging of PHI access.

HIPAA governs the protection of healthcare data in the United States. PostgreSQL installations dealing with protected health information (PHI) must meet stringent confidentiality, integrity, and availability requirements.

Data Encryption: All PHI must be encrypted at rest and in transit. Use pgcrypto or external encryption tools to secure PHI in PostgreSQL.
Access Controls: Implement strong authentication and authorization. Ensure that users and roles are defined clearly, and use multi-factor authentication (MFA) for administrative access.
Audit Trails: HIPAA requires tracking and logging of any access to PHI. PostgreSQL’s logging system and pgaudit can be configured to log these actions.

```bash
log_statement = 'all'
log_min_duration_statement = 1000
```

### 3. PostgreSQL in FISMA-Compliant Environments
- **FIPS-140-2 Encryption**: Use FIPS-compliant encryption algorithms.
- **Multi-Factor Authentication (MFA)**: Enforce MFA for critical administrative access.
- **Incident Response**: Configure PostgreSQL to detect and log security incidents as required by FISMA.

The Federal Information Security Management Act (FISMA) establishes security requirements for federal IT systems. PostgreSQL must comply with the NIST SP 800-53 framework to be used in FISMA environments.

Use FIPS-140-2 Encryption: Ensure PostgreSQL uses FIPS-compliant encryption algorithms for secure communication. PostgreSQL can be integrated with OpenSSL configured for FIPS mode, or external encryption tools can be used.

Multi-Factor Authentication (MFA): Use MFA for administrative access to the database. Integration with external identity providers (e.g., Okta, AWS IAM) can help enforce MFA policies for critical roles.

Incident Response and Auditing: Configure PostgreSQL to detect and respond to security incidents. All security-related events must be logged, and systems should have defined incident response plans.

### 4. Advanced Encryption Practices

Encryption is a cornerstone of advanced database security. Beyond basic encryption of data in transit and at rest, advanced encryption practices include key management and more sophisticated data protection strategies.

#### 4.1 Key Management
- **External Key Management**: Use external KMS (e.g., AWS KMS, HashiCorp Vault) for key storage and management.
- **Key Rotation**: Regularly rotate encryption keys to minimize risk.
  
External Key Management Systems (KMS): Rather than storing encryption keys within the database or filesystem, use external systems like AWS KMS, HashiCorp Vault, or Azure Key Vault to manage encryption keys.

```bash
aws kms encrypt --key-id alias/myKey --plaintext fileb://myfile
```

Key Rotation: Regularly rotate encryption keys to limit the potential damage from key compromise. Ensure PostgreSQL encryption supports key rotation without downtime.


#### 4.2 Transparent Data Encryption (TDE)
- **Use pgTDE**: Implement transparent data encryption to encrypt entire databases or tablespaces.

Transparent Data Encryption (TDE) encrypts the entire database at the file level. While not natively supported in PostgreSQL, tools like pgcrypto and external software can implement TDE.

pgTDE: The pgTDE extension can be used to encrypt entire databases or specific tablespaces. Data is encrypted transparently as it is written to disk.

### 5. Data Masking and Tokenization
- **Dynamic Data Masking**: Create views that mask sensitive information for non-privileged users.
- **Tokenization**: Use tokenization to replace sensitive data with tokens for secure processing.

Data masking and tokenization protect sensitive data by obfuscating it when it is not needed. This is especially useful in test or staging environments, where real data might be exposed.

Dynamic Data Masking: PostgreSQL does not natively support data masking, but you can implement it using views to hide sensitive data:

```sql
CREATE VIEW masked_view AS
SELECT id, '****' AS credit_card FROM customers;
```

Tokenization: Use external tokenization services to replace sensitive data like credit card numbers or social security numbers with tokens. These tokens can be used for processing without exposing the real data.

### 6. Advanced Logging and Monitoring

Advanced PostgreSQL setups require more detailed logging and monitoring, especially in environments subject to compliance audits or high-level threat detection.

#### 6.1 pgaudit Configuration
- **Log DDL, DML, and Role Changes**: Ensure all structure changes and access attempts are logged.
  
Configure pgaudit to log detailed events, including access to sensitive tables, role changes, and permission escalations.

Monitor All DDL and DML Statements: Ensure that all database structure changes (DDL) and data modifications (DML) are logged for accountability.

```bash
pgaudit.log = 'ddl, role, read, write'
```

#### 6.2 Integration with SIEM Systems
- **Log Integration**: Ship PostgreSQL logs to a SIEM system for real-time monitoring and alerting on suspicious activity.

PostgreSQL logs should be integrated into Security Information and Event Management (SIEM) systems, such as Splunk, ELK Stack, or AWS CloudWatch, for real-time monitoring and alerting on suspicious activity.

Log Shipping: Configure PostgreSQL logs to be shipped to the SIEM system for analysis:

```bash
log_destination = 'stderr'
logging_collector = on
log_directory = '/var/log/postgresql'
```
Custom Alerts: Set up custom alerts in your SIEM system to notify administrators of anomalous activities like repeated failed login attempts or unauthorized role changes.

### 7. Database Hardening Automation
- **Automation with Ansible/Terraform**: Automate the hardening of PostgreSQL configurations.
- **STIG Compliance Automation**: Use tools to automatically check and enforce STIG compliance across your environment.

Automating database hardening ensures consistency and repeatability in applying security configurations. Use tools like Ansible, Terraform, or Chef to enforce PostgreSQL hardening at scale.

Automate User Creation and Role Assignment: Use Terraform or Ansible scripts to enforce role-based access controls consistently across environments.

```bash
ansible-playbook -i inventory.yml playbook.yml
```

Automate STIG Compliance Checks: Use automation scripts to ensure all PostgreSQL servers comply with STIGs or other regulatory guidelines, running compliance checks regularly to detect deviations.